<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•¼ì¶” ë‹¤ì´ìŠ¤ v3.2</title>
    <style>
        :root {
            --die-size: 60px;
            --pip-size: 13px;
            --bg-color: #2c3e50; /* ê¸°ë³¸ ë°°ê²½ */
            --cheat-bg-color: #000000; /* ì¹˜íŠ¸ ë°°ê²½ */
            --hold-color: #e74c3c;
            --accent-color: #f1c40f;
            --bonus-color: #2ecc71;
        }
        body { 
            font-family: 'Apple SD Gothic Neo', sans-serif; 
            background-color: var(--bg-color); 
            color: white; 
            display: flex; flex-direction: column; align-items: center; 
            min-height: 100vh; margin: 0; padding-bottom: 50px; 
            transition: background-color 1s ease; /* ë°°ê²½ìƒ‰ ë³€ê²½ ì• ë‹ˆë©”ì´ì…˜ */
        }
        h1 { margin-top: 20px; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        
        /* --- ì£¼ì‚¬ìœ„ ìŠ¤íƒ€ì¼ --- */
        .dice-section { display: flex; gap: 15px; margin: 20px 0; justify-content: center; }
        .die-wrapper { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .die-face {
            width: var(--die-size); height: var(--die-size); background-color: white; border-radius: 12px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1), 0 4px 8px rgba(0,0,0,0.2);
            border: 4px solid transparent; cursor: pointer; user-select: none;
            display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr);
            padding: 4px; box-sizing: border-box; transition: transform 0.15s, border-color 0.2s;
        }
        .pip { background-color: #333; border-radius: 50%; width: var(--pip-size); height: var(--pip-size); align-self: center; justify-self: center; opacity: 0; transition: opacity 0.1s; }
        
        /* ì  ìœ„ì¹˜ */
        .top-left { grid-area: 1 / 1; } .top-center { grid-area: 1 / 2; } .top-right { grid-area: 1 / 3; }
        .mid-left { grid-area: 2 / 1; } .center { grid-area: 2 / 2; }    .mid-right { grid-area: 2 / 3; }
        .bot-left { grid-area: 3 / 1; } .bot-center { grid-area: 3 / 2; } .bot-right { grid-area: 3 / 3; }
        .face-1 .center { opacity: 1; }
        .face-2 .top-right, .face-2 .bot-left { opacity: 1; }
        .face-3 .top-right, .face-3 .center, .face-3 .bot-left { opacity: 1; }
        .face-4 .top-left, .face-4 .top-right, .face-4 .bot-left, .face-4 .bot-right { opacity: 1; }
        .face-5 .top-left, .face-5 .top-right, .face-5 .center, .face-5 .bot-left, .face-5 .bot-right { opacity: 1; }
        .face-6 .top-left, .face-6 .top-right, .face-6 .mid-left, .face-6 .mid-right, .face-6 .bot-left, .face-6 .bot-right { opacity: 1; }

        .die-face.held { border-color: var(--hold-color); background-color: #ecf0f1; transform: translateY(-8px); box-shadow: 0 10px 15px rgba(0,0,0,0.3); }
        .die-number { font-weight: bold; color: #ecf0f1; font-size: 15px; }
        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(10deg); } 50% { transform: rotate(-10deg); } 75% { transform: rotate(10deg); } 100% { transform: rotate(0deg); } }
        .die-face.rolling { animation: shake 0.2s infinite linear; }

        /* --- ì•„ì´ì½˜ --- */
        .mini-die {
            display: inline-grid; width: 24px; height: 24px; background-color: #ecf0f1; border: 1px solid #bdc3c7; border-radius: 4px;
            grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); margin-right: 10px; vertical-align: middle;
        }
        .mini-pip { background-color: #7f8c8d; width: 4px; height: 4px; border-radius: 50%; align-self: center; justify-self: center; }

        /* --- ì»¨íŠ¸ë¡¤ --- */
        .controls { margin-bottom: 20px; text-align: center; }
        button#roll-btn {
            padding: 12px 35px; font-size: 20px; cursor: pointer; background-color: #f39c12; border: none; border-radius: 50px; color: white;
            box-shadow: 0 5px #d35400; transition: all 0.1s; font-weight: bold; min-width: 200px;
        }
        button#roll-btn:active { transform: translateY(3px); box-shadow: 0 2px #d35400; }
        button#roll-btn:disabled { background-color: #95a5a6; cursor: not-allowed; box-shadow: none; }
        .info { margin-top: 15px; font-size: 17px; color: #bdc3c7; }
        #rolls-left { color: var(--accent-color); font-weight: bold; font-size: 22px; margin-left: 5px;}

        /* --- ì ìˆ˜íŒ (í…Œì´ë¸”) --- */
        table { border-collapse: separate; border-spacing: 0; width: 380px; background-color: white; color: #2c3e50; border-radius: 12px; overflow: visible; box-shadow: 0 10px 25px rgba(0,0,0,0.3); margin-bottom: 20px; }
        
        tr { height: 48px; }
        th, td { padding: 0 15px; text-align: center; border-bottom: 1px solid #eee; vertical-align: middle; }
        th { background-color: #34495e; color: white; font-weight: normal; letter-spacing: 1px; height: 40px; }
        
        td.category { text-align: left; font-weight: 600; font-size: 15px; display: flex; align-items: center; height: 48px; position: relative; cursor: default; }
        
        .score-btn { 
            width: 100%; height: 32px; padding: 0; 
            background: #f8f9fa; border: 2px dashed #bdc3c7; border-radius: 6px; 
            cursor: pointer; color: #95a5a6; font-weight: bold; font-family: inherit; font-size: 14px; 
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        .score-btn:hover:not(:disabled) { background-color: #e1e8ed; border-color: #3498db; color: #3498db; }
        .score-filled { font-weight: 800; color: #2c3e50; font-size: 18px; }

        /* ìƒë‹¨ í•©ê³„ (í”„ë¡œê·¸ë ˆìŠ¤ë°”) */
        .subtotal-row td {
            border-top: 2px solid #bdc3c7; border-bottom: 2px solid #bdc3c7; 
            font-weight: bold; font-size: 14px; color: #7f8c8d;
            background-color: transparent !important; 
        }
        .subtotal-row { background-color: #f8f9fa; transition: background 0.3s ease; }

        /* ë³´ë„ˆìŠ¤ ë‹¬ì„± ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes bonusPulse {
            0% { background-color: #2ecc71; transform: scale(1); }
            50% { background-color: #27ae60; transform: scale(1.02); }
            100% { background-color: #2ecc71; transform: scale(1); }
        }
        .bonus-achieved td { color: white !important; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); border-color: #27ae60 !important; }
        .bonus-achieved { animation: bonusPulse 2s infinite; }

        /* íˆ´íŒ */
        td.category[data-desc]:hover::after {
            content: attr(data-desc);
            position: absolute; left: 10px; bottom: 40px; 
            background-color: rgba(0, 0, 0, 0.9); color: white;
            padding: 8px 12px; border-radius: 6px;
            font-size: 13px; font-weight: normal; white-space: nowrap;
            z-index: 100; pointer-events: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            opacity: 0; animation: fadeIn 0.2s forwards;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* ì´ì  */
        .total-row td { background-color: var(--accent-color); color: #c0392b; font-weight: 900; font-size: 20px; border-top: 3px solid #e67e22; }

        /* í•˜ë‹¨ ì¬ì‹œì‘ ë²„íŠ¼ */
        .restart-btn { background: transparent; border: 1px solid #7f8c8d; color: #95a5a6; padding: 8px 16px; border-radius: 20px; cursor: pointer; margin-top: 10px; }
        .restart-btn:hover { background: #e74c3c; border-color: #e74c3c; color: white; }

        /* ì¹˜íŠ¸ íŠ¸ë¦¬ê±° (ì–‘ì‹¬ì— ì°”ë¦¬ê¸°) */
        .cheat-trigger {
            margin-top: 20px; font-size: 11px; color: #444; 
            cursor: pointer; text-decoration: none; opacity: 0.5; transition: opacity 0.3s;
        }
        .cheat-trigger:hover { opacity: 1; color: #e74c3c; font-weight: bold; }

    </style>
</head>
<body>

    <h1 id="game-title">ğŸ² ì•¼ì¶” ë‹¤ì´ìŠ¤</h1>

    <div class="dice-section" id="dice-container"></div>

    <div class="controls">
        <button id="roll-btn" onclick="startRollAnimation()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°!</button>
        <div class="info">ë‚¨ì€ íšŸìˆ˜: <span id="rolls-left">3</span></div>
    </div>

    <table>
        <thead>
            <tr><th width="65%">ì¡±ë³´ (Categories)</th><th width="35%">ì ìˆ˜</th></tr>
        </thead>
        <tbody id="score-table"></tbody>
        <tfoot>
            <tr class="total-row"><td>ì´ì  (Total)</td><td id="grand-total">0</td></tr>
        </tfoot>
    </table>

    <div class="restart-container">
        <button class="restart-btn" onclick="confirmRestart()">ğŸ”„ ê²Œì„ ë‹¤ì‹œ ì‹œì‘</button>
    </div>

    <div class="cheat-trigger" id="cheat-trigger" onclick="activateCheatMode()">ì–‘ì‹¬ì— ì°”ë¦¬ê¸°</div>

    <script>
        let dice = [1, 1, 1, 1, 1];
        let held = [false, false, false, false, false];
        let rollsLeft = 3;
        let scores = {};
        let isRolling = false; 
        let animationInterval = null;
        
        // ì¹˜íŠ¸ ëª¨ë“œ ìƒíƒœ ë³€ìˆ˜
        let isCheatMode = false;

        const categories = [
            { id: 'ones', name: 'Aces (1ì˜ í•©)', iconValue: 1 },
            { id: 'twos', name: 'Deuces (2ì˜ í•©)', iconValue: 2 },
            { id: 'threes', name: 'Threes (3ì˜ í•©)', iconValue: 3 },
            { id: 'fours', name: 'Fours (4ì˜ í•©)', iconValue: 4 },
            { id: 'fives', name: 'Fives (5ì˜ í•©)', iconValue: 5 },
            { id: 'sixes', name: 'Sixes (6ì˜ í•©)', iconValue: 6 },
            { id: 'choice', name: 'Choice (ì „ì²´ í•©)', iconValue: 0, desc: 'ì£¼ì‚¬ìœ„ 5ê°œì˜ ì´í•© (ì¡°ê±´ ì—†ìŒ)' },
            { id: 'fourkind', name: '4 of a Kind', iconValue: 0, desc: 'ë™ì¼í•œ ì£¼ì‚¬ìœ„ 4ê°œ ì´ìƒ (ì´í•© ì ìˆ˜)' },
            { id: 'fullhouse', name: 'Full House', iconValue: 0, desc: '3ê°œ ë™ì¼ + 2ê°œ ë™ì¼ (ì´í•© ì ìˆ˜)' },
            { id: 's_straight', name: 'Small Straight', iconValue: 0, desc: 'ì—°ì†ëœ ì£¼ì‚¬ìœ„ 4ê°œ (15ì )' },
            { id: 'l_straight', name: 'Large Straight', iconValue: 0, desc: 'ì—°ì†ëœ ì£¼ì‚¬ìœ„ 5ê°œ (30ì )' },
            { id: 'yacht', name: 'â­ï¸ YACHT â­ï¸', iconValue: 0, desc: 'ì£¼ì‚¬ìœ„ 5ê°œ ëª¨ë‘ ë™ì¼ (50ì )' }
        ];

        function initGame() {
            dice = [1, 1, 1, 1, 1];
            scores = {};
            isRolling = false;
            
            // ì¹˜íŠ¸ ëª¨ë“œ ì´ˆê¸°í™” (ê²Œì„ ì¬ì‹œì‘ ì‹œ ì •ìƒìœ¼ë¡œ ë³µêµ¬)
            isCheatMode = false;
            document.body.style.backgroundColor = "var(--bg-color)";
            document.getElementById('game-title').innerText = "ğŸ² ì•¼ì¶” ë‹¤ì´ìŠ¤";
            document.getElementById('cheat-trigger').style.display = 'block'; // ë²„íŠ¼ ë‹¤ì‹œ ë³´ì´ê¸°

            // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
            const rollBtn = document.getElementById('roll-btn');
            rollBtn.innerText = "ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°!";
            rollBtn.disabled = false;
            rollBtn.onclick = startRollAnimation;
            rollBtn.style.backgroundColor = "#f39c12";

            createDiceElements(); 
            createScoreTable();   
            resetTurn();
            updateTotalScore(); 
        }

        // --- ì¹˜íŠ¸ ëª¨ë“œ í™œì„±í™” í•¨ìˆ˜ ---
        function activateCheatMode() {
            if (isCheatMode) return;
            if (!confirm("ì •ë§ ì–‘ì‹¬ì„ ë²„ë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ëª¨ë“œì—ì„œëŠ” ì£¼ì‚¬ìœ„ë¥¼ ë¬´í•œìœ¼ë¡œ êµ´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n(ë‹¤ì‹œëŠ” ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!)")) return;
            
            isCheatMode = true;
            document.body.style.backgroundColor = "var(--cheat-bg-color)"; // ë°°ê²½ ë³€ê²½ (#222222)
            document.getElementById('cheat-trigger').style.display = 'none'; // íŠ¸ë¦¬ê±° ìˆ¨ê¹€
            document.getElementById('game-title').innerText = "ğŸ˜ˆ íƒ€ë½í•œ ì•¼ì¶” ë‹¤ì´ìŠ¤";
            
            updateUIState();
        }

        function createDiceElements() {
            const container = document.getElementById('dice-container');
            container.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                const wrapper = document.createElement('div');
                wrapper.className = 'die-wrapper';
                const dieFace = document.createElement('div');
                dieFace.className = `die-face face-${dice[i]}`; 
                dieFace.id = `die-face-${i}`;
                dieFace.onclick = () => toggleHold(i);
                
                ['top-left', 'top-center', 'top-right', 'mid-left', 'center', 'mid-right', 'bot-left', 'bot-center', 'bot-right'].forEach(pos => {
                    const pip = document.createElement('div');
                    pip.className = `pip ${pos}`;
                    dieFace.appendChild(pip);
                });
                
                const dieNumber = document.createElement('div');
                dieNumber.className = 'die-number';
                dieNumber.id = `die-num-${i}`;
                dieNumber.innerText = dice[i];
                wrapper.appendChild(dieFace); wrapper.appendChild(dieNumber); container.appendChild(wrapper);
            }
        }

        function getMiniDieHTML(value) {
            let pipsHTML = '';
            const config = {
                0: [], 1: ['center'], 2: ['top-right', 'bot-left'], 3: ['top-right', 'center', 'bot-left'],
                4: ['top-left', 'top-right', 'bot-left', 'bot-right'], 5: ['top-left', 'top-right', 'center', 'bot-left', 'bot-right'],
                6: ['top-left', 'top-right', 'mid-left', 'mid-right', 'bot-left', 'bot-right']
            };
            (config[value] || []).forEach(pos => { pipsHTML += `<div class="mini-pip ${pos}"></div>`; });
            return `<div class="mini-die">${pipsHTML}</div>`;
        }

        function createScoreTable() {
            const tbody = document.getElementById('score-table');
            tbody.innerHTML = '';
            categories.forEach((cat, index) => {
                if (index === 6) {
                    const subRow = document.createElement('tr');
                    subRow.className = 'subtotal-row';
                    subRow.id = 'subtotal-row'; 
                    subRow.innerHTML = `
                        <td style="text-align:right;">ìƒë‹¨ í•©ê³„ (63ì  ì´ìƒ +35)</td>
                        <td id="upper-subtotal-cell">0 / 63</td>
                    `;
                    tbody.appendChild(subRow);
                }

                const tr = document.createElement('tr');
                const iconHTML = getMiniDieHTML(cat.iconValue);
                const tooltipAttr = cat.desc ? `data-desc="${cat.desc}"` : '';
                
                tr.innerHTML = `
                    <td class="category" ${tooltipAttr}>${iconHTML} <span>${cat.name}</span></td>
                    <td><button class="score-btn" id="btn-${cat.id}" onclick="selectCategory('${cat.id}')">-</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function resetTurn() {
            rollsLeft = 3;
            held = [false, false, false, false, false];
            updateUIState();
            renderDiceVisuals(); 
            updateScorePreview(true);
        }

        function confirmRestart() {
            if (confirm("ì •ë§ ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì¹˜íŠ¸ ëª¨ë“œë„ ì´ˆê¸°í™”ë©ë‹ˆë‹¤)")) {
                if (animationInterval) clearInterval(animationInterval);
                initGame();
            }
        }

        function startRollAnimation() {
            // ì¹˜íŠ¸ ëª¨ë“œì¼ ë• íšŸìˆ˜ ì œí•œ ì—†ìŒ, ì¼ë°˜ ëª¨ë“œì¼ ë• 0ì´ë©´ ë¶ˆê°€
            if (isRolling) return;
            if (!isCheatMode && rollsLeft <= 0) return;

            isRolling = true;
            document.getElementById('roll-btn').disabled = true;
            
            // ì¹˜íŠ¸ ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ íšŸìˆ˜ ì°¨ê°
            if (!isCheatMode) {
                rollsLeft--;
            }

            updateUIState();
            updateScorePreview(true); 
            let frames = 0;
            dice.forEach((_, i) => { if (!held[i]) document.getElementById(`die-face-${i}`).classList.add('rolling'); });
            animationInterval = setInterval(() => {
                dice.forEach((_, i) => { if (!held[i]) dice[i] = Math.floor(Math.random() * 6) + 1; });
                renderDiceVisuals(); frames++;
                if (frames >= 15) { clearInterval(animationInterval); finishRoll(); }
            }, 60); 
        }

        function finishRoll() {
            dice.forEach((_, i) => {
                if (!held[i]) dice[i] = Math.floor(Math.random() * 6) + 1;
                document.getElementById(`die-face-${i}`).classList.remove('rolling');
            });
            renderDiceVisuals(); updateScorePreview(false); isRolling = false;
            
            // êµ´ë¦¬ê¸° ì™„ë£Œ í›„ ë²„íŠ¼ í™œì„±í™” ë¡œì§
            const rollBtn = document.getElementById('roll-btn');
            if (isCheatMode || rollsLeft > 0) {
                rollBtn.disabled = false;
            } else {
                rollBtn.disabled = true; // ì¼ë°˜ ëª¨ë“œì´ê³  0íšŒë©´ ë¹„í™œì„±
            }
        }

        function toggleHold(index) {
            // ì•„ì§ í•œ ë²ˆë„ ì•ˆ êµ´ë ¸ìœ¼ë©´ í™€ë“œ ë¶ˆê°€ (ì¼ë°˜/ì¹˜íŠ¸ ê³µí†µ)
            // ì¹˜íŠ¸ ëª¨ë“œì—¬ë„ ì²« ë¡¤ ì „ì—ëŠ” í™€ë“œ ì˜ë¯¸ ì—†ìŒ
            if (!isCheatMode && rollsLeft === 3) return; 
            // ì¹˜íŠ¸ ëª¨ë“œëŠ” rollsLeftê°€ ì¤„ì§€ ì•Šì§€ë§Œ, ì´ˆê¸°ê°’ì¸ì§€ í™•ì¸ í•„ìš”í•˜ë‚˜ 
            // ì—¬ê¸°ì„œëŠ” í¸ì˜ìƒ ê·¸ëƒ¥ ë‘ . ëŒ€ì‹  êµ´ë¦¬ëŠ” ì¤‘ì—” ë¶ˆê°€.
            if (isRolling) return;

            held[index] = !held[index];
            renderDiceVisuals();
        }

        function updateUIState() {
             const rollsSpan = document.getElementById('rolls-left');
             
             // ì¹˜íŠ¸ ëª¨ë“œ UI ì²˜ë¦¬
             if (isCheatMode) {
                 rollsSpan.innerHTML = "<span style='font-size:24px;'>&#8734;</span>"; // ë¬´í•œëŒ€ ê¸°í˜¸
             } else {
                 rollsSpan.innerText = rollsLeft;
             }

             const rollBtn = document.getElementById('roll-btn');
             if(rollBtn.onclick === initGame) return; 

             // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë° í™œì„±í™” ìƒíƒœ
             if (!isCheatMode && rollsLeft === 0) {
                 rollBtn.disabled = true; rollBtn.innerText = "ì ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš” ğŸ‘‡"; rollBtn.style.backgroundColor = "#95a5a6";
             } else {
                 rollBtn.disabled = false; 
                 // ì¹˜íŠ¸ ëª¨ë“œì¼ ë• í•­ìƒ 'êµ´ë¦¬ê¸°'
                 if (isCheatMode) {
                     rollBtn.innerText = "ë¬´í•œ êµ´ë¦¬ê¸°! ğŸ˜ˆ";
                     rollBtn.style.backgroundColor = "#e74c3c"; // ë¶‰ì€ìƒ‰
                 } else {
                     rollBtn.innerText = rollsLeft === 3 ? "ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°!" : "ë‹¤ì‹œ êµ´ë¦¬ê¸°"; 
                     rollBtn.style.backgroundColor = "#f39c12";
                 }
             }
        }

        function renderDiceVisuals() {
            dice.forEach((val, i) => {
                const face = document.getElementById(`die-face-${i}`);
                const num = document.getElementById(`die-num-${i}`);
                face.classList.remove('face-1', 'face-2', 'face-3', 'face-4', 'face-5', 'face-6');
                face.classList.add(`face-${val}`);
                if (held[i]) face.classList.add('held'); else face.classList.remove('held');
                num.innerText = val;
            });
        }

        function calculateScore(category, currentDice) {
            const counts = {};
            currentDice.forEach(d => { counts[d] = (counts[d] || 0) + 1; });
            const values = Object.values(counts);
            const keys = Object.keys(counts).map(Number).sort((a,b)=>a-b);
            const sum = currentDice.reduce((a,b)=>a+b, 0);

            switch(category) {
                case 'ones': return (counts[1] || 0) * 1;
                case 'twos': return (counts[2] || 0) * 2;
                case 'threes': return (counts[3] || 0) * 3;
                case 'fours': return (counts[4] || 0) * 4;
                case 'fives': return (counts[5] || 0) * 5;
                case 'sixes': return (counts[6] || 0) * 6;
                case 'choice': return sum;
                case 'fourkind': return values.some(v => v >= 4) ? sum : 0;
                case 'fullhouse': return (values.includes(3) && values.includes(2)) || values.includes(5) ? sum : 0;
                case 's_straight': 
                    let maxStraight = 0; let currentStraight = 0;
                    const uniqueKeys = [...new Set(keys)];
                    for(let i=0; i<uniqueKeys.length; i++) {
                        if(i>0 && uniqueKeys[i] === uniqueKeys[i-1]+1) currentStraight++; else currentStraight = 1;
                        maxStraight = Math.max(maxStraight, currentStraight);
                    }
                    return maxStraight >= 4 ? 15 : 0;
                case 'l_straight':
                     let l_straight = 0; const uKeysL = [...new Set(keys)];
                     for(let i=0; i<uKeysL.length; i++) { if(i>0 && uKeysL[i] === uKeysL[i-1]+1) l_straight++; else l_straight = 1; }
                     return l_straight >= 5 ? 30 : 0;
                case 'yacht': return values.includes(5) ? 50 : 0;
                default: return 0;
            }
        }

        function updateScorePreview(clear) {
            categories.forEach(cat => {
                if (scores[cat.id] !== undefined) return;
                const btn = document.getElementById(`btn-${cat.id}`);
                if (clear) {
                    btn.innerText = "-"; btn.disabled = true;
                    btn.style.color = "#95a5a6"; btn.style.borderColor = "#bdc3c7"; btn.style.backgroundColor = "#f8f9fa";
                } else {
                    const potentialScore = calculateScore(cat.id, dice);
                    btn.innerText = potentialScore > 0 ? `+${potentialScore}` : '0';
                    btn.disabled = false;
                    if(potentialScore > 0) {
                        btn.style.color = "#2980b9"; btn.style.borderColor = "#3498db"; btn.style.backgroundColor = "#ebf5fb";
                    } else {
                        btn.style.color = "#95a5a6"; btn.style.borderColor = "#bdc3c7"; btn.style.backgroundColor = "#f8f9fa";
                    }
                }
            });
        }

        function selectCategory(catId) {
            if (isRolling) return;
            // ì¹˜íŠ¸ ëª¨ë“œì¼ ë• 0ì  í™•ì¸ íŒ¨ìŠ¤í• ê¹Œ í•˜ë‹¤ê°€, ê·¸ë˜ë„ ì‹¤ìˆ˜ëŠ” ë°©ì§€
            if (!isCheatMode && rollsLeft === 3 && !confirm("í•œ ë²ˆë„ ì•ˆ êµ´ë¦¬ê³  0ì ì„ ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            const score = calculateScore(catId, dice);
            scores[catId] = score;

            const btn = document.getElementById(`btn-${catId}`);
            btn.parentElement.innerHTML = `<span class="score-filled">${score}</span>`;
            updateTotalScore();
            if (Object.keys(scores).length === categories.length) endGame();
            else resetTurn();
        }

        function updateTotalScore() {
            let upperSum = 0;
            ['ones','twos','threes','fours','fives','sixes'].forEach(id => {
                if (scores[id] !== undefined) upperSum += scores[id];
            });

            const subRow = document.getElementById('subtotal-row');
            const subtotalCell = document.getElementById('upper-subtotal-cell');
            
            if (upperSum >= 63) {
                subtotalCell.innerHTML = `${upperSum} / 63 (+35 Bonus!)`;
                subRow.className = 'subtotal-row bonus-achieved';
                subRow.style.background = ''; 
            } else {
                subtotalCell.innerHTML = `${upperSum} / 63`;
                subRow.className = 'subtotal-row';
                const percent = Math.min((upperSum / 63) * 100, 100);
                subRow.style.background = `linear-gradient(to right, #ffeaa7 ${percent}%, #f8f9fa ${percent}%)`;
            }

            let total = upperSum;
            if (upperSum >= 63) total += 35;
            ['choice','fourkind','fullhouse','s_straight','l_straight','yacht'].forEach(id => {
                if(scores[id] !== undefined) total += scores[id];
            });
            
            document.getElementById('grand-total').innerText = total;
        }
        
        function endGame() {
            const finalScore = document.getElementById('grand-total').innerText;
             const rollBtn = document.getElementById('roll-btn');
             
             rollBtn.disabled = false;
             rollBtn.innerText = "ğŸ”„ ê²Œì„ ë‹¤ì‹œ ì‹œì‘";
             rollBtn.style.backgroundColor = "#27ae60"; 
             rollBtn.onclick = initGame; 

             // ì—”ë”© ë©”ì‹œì§€ ë¶„ê¸° (ì¹˜íŠ¸ vs ì •ìƒ)
             let msg = `ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!\nìµœì¢… ì ìˆ˜: ${finalScore}`;
             if (isCheatMode) {
                 msg = `ì–‘ì‹¬ì— í„¸ì´ ë‚˜ì…¨ë„¤ìš”! ğŸ¦\nìµœì¢… ì ìˆ˜: ${finalScore} (ì¹˜íŠ¸ ì‚¬ìš©ë¨)`;
             }

             setTimeout(() => alert(msg), 200);
        }

        initGame();
    </script>
</body>
</html>
